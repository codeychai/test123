var script = {
	stage01:{
		map:[
				[47,67,67,67,67,67,67,67,67,67,67,90,67,67,67,67,67,67,67,67,67,67,90,67,67,67,67,67,67,47],
				[48,119,57,57,57,57,97,98,57,57,57,90,276,175,176,69,69,69,69,175,176,69,90,71,106,107,107,107,108,46],
				[48,119,152,153,153,154,117,118,152,153,154,90,276,195,196,95,96,95,96,195,196,69,90,71,146,147,147,147,148,46],
				[48,69,69,69,69,64,64,64,64,64,64,90,276,315,316,315,256,316,4,316,256,69,90,71,130,130,130,130,130,46],
				[48,135,335,336,69,296,296,296,296,296,69,90,316,4,4,189,190,190,191,4,316,69,90,71,130,112,130,130,112,46],
				[48,155,355,356,316,316,315,316,315,315,315,90,276,4,4,209,210,210,211,4,255,69,90,179,1,179,1,1,179,46],
				[48,135,375,376,4,103,104,104,104,105,69,90,276,29,135,229,230,230,231,4,175,176,90,258,71,71,71,71,71,46],
				[48,155,395,396,315,143,144,144,144,145,69,90,276,276,155,115,116,115,116,316,195,196,90,139,97,98,18,19,19,46],
				[48,296,296,296,296,111,111,111,111,111,69,90,276,276,296,295,315,296,315,316,315,69,90,159,117,118,39,112,39,46],
				[48,177,178,177,178,109,109,112,109,109,69,90,276,235,315,49,315,315,23,24,25,69,90,1,179,1,1,179,119,46],
				[48,1,1,1,179,87,87,87,87,87,87,90,276,315,256,296,315,315,43,278,45,69,90,139,137,138,139,137,138,46],
				[48,277,64,64,64,137,138,54,54,54,69,90,276,135,315,315,316,256,63,64,65,69,90,159,157,158,159,157,158,46],
				[48,69,69,69,69,157,158,173,173,173,69,90,276,155,115,116,115,116,276,276,276,69,90,277,100,101,101,101,102,46],
				[48,14,14,15,69,69,216,151,151,174,69,90,69,69,69,69,69,69,69,69,69,69,90,71,140,141,141,141,142,46],
				[48,174,172,172,114,5,47,87,87,87,87,87,87,87,87,87,87,87,87,87,87,87,90,71,249,250,250,250,251,46],
				[48,43,69,69,69,69,90,69,69,69,69,43,18,18,18,256,69,69,69,69,90,296,90,71,249,250,112,250,251,46],
				[48,43,103,104,105,69,90,69,74,74,69,43,174,150,173,316,315,316,275,69,90,296,90,71,119,119,179,119,119,46],
				[48,43,143,144,145,69,90,69,193,194,69,63,1,180,181,181,181,181,181,182,90,87,87,87,87,87,87,87,87,87],
				[48,43,132,132,132,69,90,69,296,316,69,69,43,220,221,221,221,221,221,222,90,216,69,69,69,5,74,74,74,46],
				[48,43,132,132,132,69,90,69,275,316,315,69,43,110,110,110,110,110,110,110,90,69,23,24,24,1,174,173,172,46],
				[48,43,132,133,134,69,90,69,115,116,315,69,43,110,110,110,110,110,110,110,90,69,43,20,21,5,5,29,69,46],
				[48,63,64,64,64,5,90,216,69,69,256,69,43,154,110,110,112,110,110,154,90,69,5,69,69,69,69,69,69,46],
				[48,69,103,104,105,69,90,87,87,87,87,87,47,87,87,87,87,87,87,87,47,64,1,103,104,104,104,104,105,46],
				[48,69,143,144,145,69,90,69,69,57,57,69,90,20,21,21,21,21,21,22,90,69,43,143,144,144,144,144,145,46],
				[48,69,132,133,132,69,90,69,275,133,134,69,90,40,296,41,275,41,296,42,90,69,43,133,132,132,132,132,133,46],
				[48,69,132,133,132,69,90,69,5,5,5,5,90,60,61,61,61,61,61,62,90,69,43,132,132,133,132,132,132,46],
				[48,69,132,133,134,69,90,69,18,18,19,69,87,87,87,87,47,87,87,87,47,69,43,134,132,132,132,132,134,46],
				[48,4,63,64,64,5,90,69,154,152,154,69,276,276,276,47,90,47,276,276,276,69,63,64,64,64,64,64,65,46],
				[47,27,27,27,27,27,90,244,47,27,47,27,27,27,27,244,90,47,27,27,27,27,27,27,27,27,27,27,27,47],
				[87,87,87,87,87,87,87,244,87,87,87,87,87,87,87,244,87,87,87,87,87,87,87,87,87,87,87,87,87,87],
				[67,67,67,67,67,67,47,244,47,67,67,47,67,67,67,244,47,47,67,67,67,47,67,67,67,67,67,67,67,67],
				[64,64,64,64,64,64,1,64,270,64,64,269,64,64,64,64,64,64,64,64,64,1,129,167,129,1,64,64,64,277],
				[69,69,69,69,69,69,5,69,69,69,69,69,69,69,69,69,69,69,69,69,69,43,263,264,265,45,69,69,69,69],
				[69,275,236,4,4,4,5,256,4,4,4,4,275,69,135,236,4,4,4,4,256,63,1,1,1,65,256,4,296,69],
				[69,69,115,116,69,69,5,69,69,69,115,116,69,69,155,115,116,69,69,115,116,69,69,69,69,69,69,115,116,69]],


		mapdata:[
					[1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1],
					[1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1],
					[1,1,1,1,1,0,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1],
					[1,1,1,1,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,1,1],
					[1,1,0,0,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,0,0,1,0,1,1,0,1,1,0,1],
					[1,1,0,0,0,0,0,0,0,0,0,0,1,0,0,1,1,1,1,0,0,1,0,0,0,0,0,0,0,1],
					[1,1,0,0,0,1,1,1,1,1,1,0,1,0,1,1,1,1,1,0,1,1,0,0,1,1,1,1,1,1],
					[1,1,0,0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1],
					[1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,0,1,0,0,0,1,0,1,1,1,1,0,1,1],
					[1,1,1,1,1,1,1,0,1,1,1,0,1,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,1],
					[1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1,0,1,1,1,1,1,1,1],
					[1,1,0,0,0,1,1,1,1,1,1,0,1,1,0,0,0,0,0,0,0,1,0,1,1,1,1,1,1,1],
					[1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1],
					[1,1,1,1,1,1,0,1,1,0,1,0,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1],
					[1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1],
					[1,0,1,1,1,1,0,1,1,1,1,0,1,1,1,0,1,1,1,1,0,1,0,1,1,1,0,1,1,1],
					[1,0,1,1,1,1,0,1,1,1,1,0,0,1,1,0,0,0,1,1,0,1,0,1,1,1,0,1,1,1],
					[1,0,1,1,1,1,0,1,1,0,1,0,0,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0],
					[1,0,1,1,1,1,0,1,1,0,1,1,0,1,1,1,1,1,1,1,0,0,1,1,1,0,1,1,1,1],
					[1,0,1,1,1,1,0,1,1,0,0,1,0,1,1,1,1,1,1,1,0,1,0,0,0,0,0,1,1,1],
					[1,0,1,1,0,1,0,1,1,1,0,1,0,1,1,1,1,1,1,1,0,1,0,0,0,0,0,0,1,1],
					[1,0,0,0,0,0,0,0,1,1,0,1,0,0,1,1,0,1,1,0,0,1,0,1,1,1,1,1,1,1],
					[1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1],
					[1,1,1,1,1,1,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,1,1],
					[1,1,1,1,1,1,0,1,1,1,0,1,0,0,1,0,1,0,1,0,0,1,0,1,1,1,1,1,1,1],
					[1,1,1,1,1,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,1,1],
					[1,1,1,1,0,1,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,1,0,0,1,1,1,1,0,1],
					[1,0,0,0,0,0,0,1,0,1,0,1,1,1,1,0,0,0,1,1,1,1,0,0,0,0,0,0,0,1],
					[1,1,1,1,1,1,0,0,0,1,0,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1],
					[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
					[1,1,1,1,1,1,0,0,0,1,1,0,1,1,1,0,0,0,1,1,1,0,1,1,1,1,1,1,1,1],
					[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1],
					[1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,1,1,1,1],
					[1,1,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],
					[1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],
		add:[
		     {chara:"player",img:"mingren",x:5,y:3},
		     {chara:"npc",img:"npc1",x:8,y:3},
		     {chara:"npc",img:"npc1",x:26,y:20}],
		talk:{
			talk1:[
		    		  {img:"m",name:"鸣人",msg:"我是木叶村的鸣人，你是谁？"},
		    		  {img:"n",name:"黑衣忍者甲",msg:"你就是鸣人？九尾还在你身体里吗？"}
		    	  ],
		    talk2:[
		    	      {img:"n",name:"黑衣忍者乙",msg:"鸣人，听说忍者大战就要开始了。"},
		    		  {img:"m",name:"鸣人",msg:"真的吗？一定要想想办法啊。"}
		    	  ]
		},
		jump:[
		      {at:{x:19,y:21},to:"stage02"}
		]
	},
	stage02:{
		map:[
		    [0,0,1,2,2,2,2,2,2,2,2,1,0,0,0],
		    [0,0,1,3,5,5,1,5,5,5,5,1,0,0,0],
		    [0,0,1,80,4,4,1,80,4,4,4,1,0,0,0],
		    [0,0,1,80,4,4,1,80,8,7,8,1,0,0,0],
			[0,0,1,80,4,4,5,81,4,4,4,1,0,0,0],
			[0,0,1,2,2,2,6,4,4,4,4,1,0,0,0],
			[0,0,1,3,5,5,81,4,4,4,4,1,0,0,0],
			[0,0,1,80,4,4,4,4,4,4,9,1,0,0,0],
			[0,0,1,2,2,2,2,6,2,2,2,1,0,0,0]],
		mapdata:[
			[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
			[1,1,1,0,0,0,1,0,0,0,0,1,1,1,1],
			[1,1,1,0,0,0,1,0,0,0,0,1,1,1,1],
			[1,1,1,0,0,0,1,0,0,1,0,1,1,1,1],
			[1,1,1,0,0,0,0,0,0,0,0,1,1,1,1],
			[1,1,1,1,1,1,0,0,0,0,0,1,1,1,1],
			[1,1,1,0,0,0,0,0,0,0,0,1,1,1,1],
			[1,1,1,0,0,0,0,0,0,0,1,1,1,1,1],
			[1,1,1,1,1,1,1,0,1,1,1,1,1,1,1]],
		add:[
		     {chara:"player",img:"mingren",x:7,y:8},
		     {chara:"npc",img:"npc1",x:8,y:3},
		     {chara:"npc",img:"npc1",x:10,y:3}],
		talk:{
		      talk1:[
		    	        {img:"m",name:"鸣人",msg:"你们在干什么啊？"},
			    		{img:"n",name:"黑衣忍者甲",msg:"我们在喝茶。"}
		    	  ],
		      talk2:[
			    	    {img:"n",name:"黑衣忍者乙",msg:"我们在喝茶，你不要打扰我们。"},
			    		{img:"m",name:"鸣人",msg:"....."}
		    	  ]
		},
		jump:[
		      {at:{x:7,y:8},to:"stage01"}
		]
	}

};
//根据脚本，初始化游戏画面
function initScript(){
	//地图位置初始化
	mapLayer.x = 0;
	mapLayer.y = 0;
	charaLayer.x = 0;
	charaLayer.y = 0;

	//地图层初始化
	mapLayer.removeAllChild();
	//人物层初始化
	charaLayer.removeAllChild();
	//效果层初始化
	effectLayer.removeAllChild();
	//对话层初始化
	talkLayer.removeAllChild();
	
	//地图数据获取
	map = stage.map;
	mapdata = stage.mapdata;
	//对话数据获取
	talkScriptList = stage.talk;
	
	//添加地图
	addMap(0,0);
	delMap();
	//添加人物
	addChara();
	
}
//游戏场景跳转测试
function checkJump(){
	var jump = stage.jump;
	var jumpstage;
	for(var i=0;i<jump.length;i++){
		jumpstage = jump[0];
		if(player.x == jumpstage.at.x * 32 && player.y == jumpstage.at.y * 32){
			//获取该场景脚本数据
			stage = script[jumpstage.to];
			//开始跳转
			initScript(stage);
			return;
		}
	}
}